<Page x:Class="project_7.Views.PageReception"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:project_7.Views" 
      xmlns:validators="clr-namespace:project_7.ValidationRules"
      mc:Ignorable="d" 
      d:DesignHeight="500" d:DesignWidth="800"
      Title="PageReception"    
      Background="{DynamicResource WindowBackground}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="50"/>
        </Grid.RowDefinitions>

        <Button Content="Изменить" Grid.Column="0" Grid.Row="0" Command="{Binding SavePacientCommand}" Style="{StaticResource AddButton}"/>
        <Button Content="Назад" Grid.Column="1" Grid.Row="0" Command="{Binding Back}" Style="{StaticResource StandardButton}"/>

        <ListView Grid.Row="1" Grid.Column="1" Style="{StaticResource ListViewStyle}" ItemsSource="{Binding AppoinmentHistory}">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <StackPanel Margin="5">
                        <TextBlock Text="{Binding Date, StringFormat='Дата приёма: dd.MM.yyyy HH:mm'}" Style="{StaticResource TextBlockStyle}"/>
                        <TextBlock Text="{Binding DoctorId, StringFormat='ID доктора: {0}'}" Style="{StaticResource TextBlockStyle}"/>
                        <TextBlock Text="{Binding Diagnosis, StringFormat='Диагноз: {0}'}" TextWrapping="Wrap" Style="{StaticResource TextBlockStyle}"/>
                        <TextBlock Text="{Binding Recomendations, StringFormat='Рекомендации: {0}'}" TextWrapping="Wrap" Style="{StaticResource TextBlockStyle}"/>
                        <TextBlock Text="{Binding DoctorLastName, StringFormat='Фамилия доктора: {0}'}" TextWrapping="Wrap" Style="{StaticResource TextBlockStyle}"/>
                        <TextBlock Text="{Binding DoctorName, StringFormat='Имя доктора: {0}'}" TextWrapping="Wrap" Style="{StaticResource TextBlockStyle}"/>
                    </StackPanel>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <Border Grid.Row="1" Grid.Column="0" Background="{DynamicResource WindowBackground}" BorderBrush="{DynamicResource ButtonBorder}">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Style="{StaticResource ScrollViewerStyle}">
                <StackPanel Style="{StaticResource FormStackPanelStyle}">
                    <TextBlock Text="Форма приёма пациента:" Style="{StaticResource FormTitleTextBlockStyle}" FontWeight="Bold"/>

                    <TextBlock Text="Идентификатор:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBlock Text="{Binding CurrentPatient.Id}" Style="{StaticResource TextBlockStyles4}"/>

                    <TextBlock Text="Фамилия:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBlock Text="{Binding CurrentPatient.LastName}" Style="{StaticResource TextBlockStyles4}"/>

                    <TextBlock Text="Имя:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBlock Text="{Binding CurrentPatient.Name}" Style="{StaticResource TextBlockStyles4}"/>

                    <TextBlock Text="Отчество:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBlock Text="{Binding CurrentPatient.MiddleName}" Style="{StaticResource TextBlockStyles4}"/>

                    <TextBlock Text="День Рождения:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBlock Text="{Binding CurrentPatient.Birthday}" Style="{StaticResource TextBlockStyles4}"/>

                    <TextBlock Text="Возраст:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBlock Text="{Binding CurrentPatient.AgeFormat}" Style="{StaticResource TextBlockStyles4}"/>

                    <TextBlock Text="Номер телефона:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBlock Text="{Binding CurrentPatient.PhoneNumber, StringFormat={}{0:### ### ## ##} }" Style="{StaticResource TextBlockStyles4}"/>

                    <TextBlock Text="Последний раз:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBlock Text="{Binding CurrentPatient.DaysSinceLastAppointment}" Style="{StaticResource TextBlockStyles4}"/>
                    
                    <TextBlock Text="Последний Доктор:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBox Text="{Binding Appointment.DoctorId, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SmallTextBoxStyle}"/>

                    <TextBlock Text="Диагноз:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBox x:Name="DiagnosisBox" TextWrapping="Wrap" AcceptsReturn="True" TextChanged="DiagnosisBox_TextChanged">
                        <TextBox.Text>
                            <Binding Path="Appointment.Diagnosis" UpdateSourceTrigger="PropertyChanged">
                                <Binding.ValidationRules>
                                    <validators:RequiredTextRule/>
                                </Binding.ValidationRules>
                            </Binding>
                        </TextBox.Text>
                    </TextBox>
                    <ItemsControl ItemsSource="{Binding ElementName=DiagnosisBox, Path=(Validation.Errors)}" Foreground="Red">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ErrorContent}" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <TextBlock Text="Рекомендации:" Style="{StaticResource TextBlockStyles2}"/>
                    <TextBox x:Name="RecomendationsBox" >
                        <TextBox.Text>
                            <Binding Path="Appointment.Recomendations" UpdateSourceTrigger="PropertyChanged">
                                <Binding.ValidationRules>
                                    <validators:RequiredTextRule/>
                                </Binding.ValidationRules>
                            </Binding>
                        </TextBox.Text>
                    </TextBox>
                    <ItemsControl ItemsSource="{Binding ElementName=RecomendationsBox, Path=(Validation.Errors)}" Foreground="Red">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ErrorContent}" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Page>
